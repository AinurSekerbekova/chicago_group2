<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Chicago fire game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="styles/main.css">
</head>

<body class="bg-light">
  <div class="container py-4">
    <div class="row align-items-start g-4">
      <div class="col-md-6">
        <div id="map" class="rounded shadow" style="height: 50vh; min-height: 300px;"></div>
      </div>
      <div class="col-md-6 d-flex justify-content-center align-items-center">
        <img src="images/old water tower.jpg" alt="Old Water tower pic" class="img-fluid rounded shadow"
          style="max-height: 50vh;">
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-12">
        <div class="p-4 rounded shadow"
          style="background: rgba(255,255,255,0.5); min-height: 50vh; max-height: 50vh; overflow-y: auto; position: relative;">
          <h2>Can you guess where this is?</h2>
          <form id="guess-form" class="position-absolute end-0 bottom-0 m-4">
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
          <div id="result" class="mt-3"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    var targetLatLng = [41.9115, -87.6315];
    var userMarker = null;
    var map = L.map('map').setView(targetLatLng, 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Позволяет пользователю поставить точку
    map.on('click', function(e) {
      if (userMarker) {
        map.removeLayer(userMarker);
      }
      userMarker = L.marker(e.latlng).addTo(map);
      userMarker.userLatLng = e.latlng;
    });

    // Обработка формы
    document.getElementById('guess-form').addEventListener('submit', function(e) {
      e.preventDefault();
      if (!userMarker || !userMarker.userLatLng) {
        document.getElementById('result').textContent = 'Please place a marker on the map!';
        return;
      }
      var userLat = userMarker.userLatLng.lat;
      var userLng = userMarker.userLatLng.lng;
      var distance = getDistanceFromLatLonInKm(userLat, userLng, targetLatLng[0], targetLatLng[1]);
      document.getElementById('result').textContent =
        'Your marker is ' + distance.toFixed(2) + ' km from the target location.';
    });

    // Функция для вычисления расстояния между двумя точками (Haversine formula)
    function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
      var R = 6371; // Радиус Земли в км
      var dLat = deg2rad(lat2 - lat1);
      var dLon = deg2rad(lon2 - lon1);
      var a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      var d = R * c;
      return d;
    }
    function deg2rad(deg) {
      return deg * (Math.PI / 180);
    }
  </script>
  <!-- Bootstrap JS (опционально) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
